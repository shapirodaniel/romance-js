function parseText(inputs) {
  return inputs
    .map((str) => str.split(" ").map((val) => val.toLowerCase()))
    .flat();
}

function generateWordPairs(parsedText) {
  return parsedText.reduce((ht, currentWord, idx) => {
    if (!ht[currentWord]) {
      ht[currentWord] = [];
    }

    if (idx < parsedText.length - 1) {
      ht[currentWord].push(parsedText[idx + 1]);
    }

    return ht;
  }, {});
}

function writeLine(mChain, length) {
  const randomWords = Object.keys(mChain);

  let line = [randomWords[Math.floor(Math.random() * randomWords.length)]];

  for (let i = 0; i < length; i++) {
    let lastWord = line[line.length - 1];

    line.push(
      mChain[lastWord][Math.floor(Math.random() * mChain[lastWord].length)]
    );
  }

  line.push("\n");

  return line.join(" ");
}

function generatePoem(wordCorpus, numLines) {
  let poem = "";
  const parsedText = parseText(wordCorpus);
  const mChain = generateWordPairs(parsedText);

  for (let i = 0; i < numLines; i++) {
    // randomize line length
    poem += writeLine(mChain, Math.ceil(Math.random() * 10));
  }

  return (
    "\n*----- This poem was generated by a Markov process -----*\n\n" + poem
  );
}

const ballad =
  "He that had come that morning One after the other Over seven hills Each of a new color Came now by the last tree By the redcolored valley To a gray river Wide as the sea There at the shingle A listing wherry Awash with dark water What should it carry There on the shelving Three dark gentlemen Might they direct him Three gentlemen Cable friend John John Cable When they saw him they said Come and be company As far as the far side Come follow the feet they said Of your family Of your old father That came already this way But Cable said First I must go Once to my sister again What will she do come spring And no man on her garden She will say Weeds are alive From here to the Stream of Friday I grieve for my brothers plowing Then break and cry Lose no sleep they said for that fallow She will say before summer I can get me a daylong man Do better than a brother Cable said I think of my wife Dearly she needs consoling I must go back for a little For fear she die of grieving Cable they said John Cable Ask no such wild favor Still if you fear she die soon The boat might wait for her But Cable said I remember Out of charity let me Go shore up my poorly mother Cries all afternoon They said She is old and far Far and rheumy with years And if you like we shall take No note of her tears But Cable said I am neither Your hired man nor maid Your dog nor shadow Nor your ape to be led He said I must go back Once I heard someone say That the hollow Stream of Friday Is a rank place to lie And this word now I remember Makes me sorry have you Thought of my own body I was always good to The frame that was my devotion And my blessing was The straight bole whose limbs Were long as stories Now poor thing left in the dirt By the Stream of Friday Might not remember me Half tenderly They let him nurse no worry They said We give you our word Poor thing is made of patience Will not say a word Cable friend John John Cable After this they said Come with no company To the far side To a populous place A dense city That shall not be changed Before much sorrow dry Over shaking water Toward the feet of his father Leaving the hills color And his poorly mother And his wife at grieving And his sisters fallow And his body lying In the rank hollow Now Cable is carried On the dark river Nor even a shadow Followed him over On the wide river Gray as the sea Flags of white water Are his company";

const animals =
  "All these years behind windows With blind crosses sweeping the tables And myself tracking over empty ground Animals I never saw I with no voice Remembering names to invent for them Will any come back will one Saying yes Saying look carefully yes We will meet again";

const dying =
  "When the forests have been destroyed their darkness remains The ash the great walker follows the possessors Forever Nothing they will come to is real Nor for long Over the watercourses Like ducks in the time of the ducks The ghosts of the villages trail in the sky Making a new twilight Rain falls into the open eyes of the dead Again again with its pointless sound When the moon finds them they are the color of everything The nights disappear like bruises but nothing is healed The dead go away like bruises The blood vanishes into the poisoned farmlands Pain the horizon Remains Overhead the seasons rock They are paper bells Calling to nothing living The possessors move everywhere under Death their star Like columns of smoke they advance into the shadows Like thin flames with no light They with no past And fire their only future";

const bread =
  "Each face in the street is a slice of bread wandering on searching somewhere in the light the true hunger appears to be passing them by they clutch have they forgotten the pale caves they dreamed of hiding in their own caves full of the waiting of their footprints hung with the hollow marks of their groping full of their sleep and their hiding have they forgotten the ragged tunnels they dreamed of following in out of the light to hear step after step the heart of bread to be sustained by its dark breath and emerge to find themselves alone before a wheat field raising its radiance to the moon";

const allPoems = [ballad, animals, dying, bread];

// randomize poem length
const myPoem = generatePoem(allPoems, Math.ceil(Math.random() * 10));

console.log(myPoem);
